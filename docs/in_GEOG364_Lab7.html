<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 7: Point Pattern Analysis</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="projectlab.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="in_GEOG364_FAQ.html">FAQs</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    YOUR LABS
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="in_GEOG364_Lab1.html">Lab 1: Basics</a>
    </li>
    <li>
      <a href="in_GEOG364_Lab2.html">Lab 2: Data summary</a>
    </li>
    <li>
      <a href="in_GEOG364_Lab3.html">Lab 3: Taiwan House</a>
    </li>
    <li>
      <a href="in_GEOG364_Lab4.html">Lab 4: Spatial Wrangling</a>
    </li>
    <li>
      <a href="in_GEOG364_Lab5.html">Lab 5: Moran's I</a>
    </li>
    <li>
      <a href="in_GEOG364_Lab6.html">Lab 6: LISA and regression</a>
    </li>
    <li>
      <a href="in_GEOG364_Lab7.html">Lab 7: Point Pattern</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Advanced Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Tutorial_CensusData.html">Getting Census Data</a>
    </li>
    <li>
      <a href="Tutorial_SpatWeights.html">Spatial Weights Matrices</a>
    </li>
    <li>
      <a href="Tutorial_Moran.html">Moran's I</a>
    </li>
    <li>
      <a href="Tutorial_LISA.html">LISA</a>
    </li>
    <li>
      <a href="Tutorial_Regression.html">Regression</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    TURTLES
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Turtle_tutorial.html">Tutorial</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 7: Point Pattern Analysis</h1>

</div>


<hr />
<p><br />
</p>
<div id="welcome-to-lab-7" class="section level1">
<h1>Welcome to Lab 7!</h1>
<p><strong>Aim of the lab</strong></p>
<p>The analysis of point patterns is focused on the spatial distribution
of observed events and making inference about the underlying process
that generated them. We have two main issues of interest: the
distribution of events in space and the existence of possible
interactions between them</p>
<div id="boxgreen">
<p><strong>This is a TWO WEEK LAB</strong> See <a
href="https://psu.instructure.com/courses/2396422/assignments/17585714">here</a>
for assignment guidelines. You must submit an <code>.Rmd</code> file and
its associated <code>.html</code> file.</p>
</div>
<p><br />
</p>
<div id="boxedtext">
<p><br />
<strong>Getting help</strong><br />
- Kiely (and often Dr G) will be present during your lab sessions. This
is the easiest way to get help.<br />
- Dr G has weekly office hours and genuinely enjoys helping with R, even
if you feel stuck or overwhelmed.<br />
- You may send a Canvas message to Kiely or Dr G (or if you are
completely lost).<br />
</p>
<p><br />
</p>
</div>
<p><br />
</p>
<hr />
<p><br />
</p>
</div>
<div id="set-up.-dont-skip" class="section level1">
<h1>Set-up. DON’T SKIP!</h1>
<p><br />
</p>
<div id="create-a-project-get-the-data" class="section level3">
<h3>Create a project &amp; get the data</h3>
<p>There are two options here depending on whether you are using
R-studio on the website (posit cloud) or your own computer (R-Desktop).
If you are using a lab computer choose the R-Desktop route.</p>
<div id="option-1.-posit-cloud-website-users" class="section level4">
<h4>Option 1. Posit Cloud Website Users</h4>
<details>
<summary>
Task 1. Create a project for Lab 7 (expand for instructions)
</summary>
<div class="collapsible-content">
<iframe src="https://psu-spatial.github.io/Stat462-2025/T5_ProjectsPositCloud.html" style="width: 100%; height: 700px; border: none;">
</iframe>
</div>
<p><br></p>
</details>
<div class="small-gap">

</div>
<details>
<summary>
Task 2. Install more packages (expand for instructions)
</summary>
<p><br></p>
<p>Unfortunately on the website you need to install your packages each
time.<br></p>
<p>First we need a package called sf, which runs a lot of the spatial
commands in R. Unfortunately, posit cloud sometimes has a few technical
issues with sf, so you will need to run a special command.</p>
<p>IN THE CONSOLE, run these two commands.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">&quot;r-spatial/sf&quot;</span>, <span class="at">ref =</span> <span class="st">&quot;93a25fd8e2f5c6af7c080f92141cb2b765a04a84&quot;</span>)</span></code></pre></div>
<p>Go to to the packages tab, click install to get to the app-store and
download/install these packages:</p>
<ul>
<li><code>AER</code></li>
<li><code>broom</code></li>
<li><code>elevatr</code></li>
<li><code>ggplot2</code></li>
<li><code>kableExtra</code></li>
<li><code>openintro</code></li>
<li><code>osmdata</code></li>
<li><code>sp</code></li>
<li><code>sf</code></li>
<li><code>plotly</code></li>
<li><code>RColorBrewer</code></li>
<li><code>readxl</code></li>
<li><code>rmapshaper</code></li>
<li><code>skimr</code></li>
<li><code>sfdep</code></li>
<li><code>spatstat</code></li>
<li><code>spdep</code></li>
<li><code>tidycensus</code></li>
<li><code>tidyverse</code></li>
<li><code>tigris</code></li>
<li><code>tmap</code></li>
<li><code>viridis</code></li>
</ul>
<p>T6_Packages.html <br><em>Reminder: <a
href="https://psu-spatial.github.io/Stat462-2025/T6_Packages.html">Tutorial:
Packages cheatsheet</a></em>.</p>
</details>
</div>
<div id="option-2.-r-desktop-users" class="section level4">
<h4>Option 2. R-Desktop Users</h4>
<details>
<summary>
Task 1. Create a project for Lab 7
</summary>
<p><br></p>
<div class="collapsible-content">
<iframe src="https://psu-spatial.github.io/Stat462-2025/T5_ProjectsRDesktop.html" style="width: 100%; height: 700px; border: none;">
</iframe>
</div>
</details>
<div class="small-gap">

</div>
<p><br></p>
</div>
</div>
<div id="set-up-your-lab-7-report" class="section level3">
<h3>Set-up your Lab 7 report</h3>
<p>You are welcome to use/edit the template you made in previous labs.
If you are unsure what I mean by that, follow these instructions.</p>
<details>
<summary>
Task. Create your RMarkdown file - expand &amp; look at Tutorial 4B and
4C
</summary>
<p><br></p>
<div class="collapsible-content">
<iframe src="https://hgreatrex.github.io/Geog364_2024/pg_Tut4_markdown.html#Tutorial_4B:_Creating_a_markdown_document" style="width: 100%; height: 700px; border: none;">
</iframe>
</div>
</details>
<div class="small-gap">

</div>
<details>
<summary>
Task. Edit your YAML code &amp; ADD A NEW THEME
</summary>
<p><br></p>
<p>Lets use similar options to Lab 4. Remember YAML code is annoying to
edit, because here, <em>spaces really do matter</em>. Everything has to
be perfect or it won’t knit.</p>
<ul>
<li><p><strong>Select everything in my code chunk here and replace your
YAML with this (remember the — on line 1 and at the
end).</strong></p></li>
<li><p>Now edit the author name to your own. If you wonder what
Sys.Date() is, don’t touch it - it automatically gives you the current
date.</p></li>
<li><p>Now change your theme to your favourite one of these - you can
see what it looks like by pressing knit. Note, DO NOT put quote marks
around the theme name.</p>
<ul>
<li>bootstrap</li>
<li>cerulean</li>
<li>cosmo</li>
<li>darkly</li>
<li>flatly</li>
<li>journal</li>
<li>lumen</li>
<li>paper</li>
<li>readable</li>
<li>sandstone</li>
<li>simplex</li>
<li>spacelab</li>
<li>united</li>
<li>yeti</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">#---------------------------------------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">, Your theme does NOT have quote marks around it </span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#---------------------------------------------------------</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>title<span class="sc">:</span> <span class="st">&quot;GEOG-364 - Lab 7&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>author<span class="sc">:</span> <span class="st">&quot;hlg5155&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>date<span class="sc">:</span> <span class="st">&quot;`r Sys.Date()`&quot;</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>output<span class="sc">:</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  html_document<span class="sc">:</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    toc<span class="sc">:</span> true</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    toc_float<span class="sc">:</span> yes</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    number_sections<span class="sc">:</span> yes</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    theme<span class="sc">:</span> lumen</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    df_print<span class="sc">:</span> paged</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="sc">---</span></span></code></pre></div>
</details>
<div class="small-gap">

</div>
<details>
<summary>
Task. Delete the existing text and create/run your library code chunk
</summary>
<p><br></p>
<ul>
<li><p>Click on your lab script (the Rmd file) and delete all the
‘welcome text’ after line 11.<br>Press enter a few times and make a new
level-1 heading called <code>Set Up</code>.<br></p></li>
<li><p>We should have all the packages we need installed, but we need to
open them. Make a new code chunk containing this code.<br></p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">library</span>(elevatr)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">library</span>(openintro)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="fu">library</span>(sfdep)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="fu">library</span>(spatstat) <span class="co"># NEW!  You might have to install this.</span></span></code></pre></div>
<p><br></p>
<ul>
<li><p>Press the green arrow on the right of the code chunk to run the
code inside it. You will see a load of “loading text” telling your
details about the packages you just loaded.<br><br> Press the green
arrow AGAIN. The text should disappear unless there is an
error.<br></p></li>
<li><p>Note, remember to run this code chunk EVERY TIME your start
R-Studio (in the same way you need to click on an app on your phone
before you can use it). <br></p></li>
</ul>
<p>You might need additional libraries as you work through the lab. If
so, add them in this code chunk AND REMEMBER TO RERUN. If you see a
little yellow bar at the top asking you to install them,click yes!</p>
<p><br></p>
</details>
<div class="small-gap">

</div>
<details>
<summary>
Task. Add warning=FALSE and message=FALSE to your library code chunk.
</summary>
<p><br><br><br></p>
<div class="collapsible-content">
<iframe src="https://psu-spatial.github.io/Stat462-2025/T7_Markdown_4bCodeChunkOptions.html" style="width: 100%; height: 700px; border: none;">
</iframe>
</div>
</details>
<div class="small-gap">

</div>
</div>
<div id="check-your-progress" class="section level3">
<h3>Check your progress</h3>
<p>Your lab script should now look similar this, but with your theme and
YAML options of choice (you might have a few different libraries than in
my screenshot). You should also be able to knit it successfully. If not,
go back and do the previous sections!</p>
<p><br></p>
<p><img src="index_images/pg_364Lab2_Summary_2021_fig2.png" /></p>
<p><br><br></p>
<hr />
</div>
</div>
<div id="week-1" class="section level1">
<h1>WEEK 1</h1>
<div id="a.-introduction" class="section level2">
<h2>A. Introduction</h2>
<p>This lab introduces <strong>point pattern analysis</strong>, a
technique used to study the spatial distribution of individual events or
locations. We’ll explore how and where things happen by examining the
locations of <strong>McDonald’s restaurants</strong> and
<strong>schools</strong> in <strong>Upstate New York</strong>. By
comparing their spatial patterns, we’ll begin to ask: <em>Are these
points randomly distributed, clustered, or evenly spaced at different
scales.</em> Then use our results to explore the social, economic, and
geographic processes that shape them.</p>
<p>Point pattern analysis examines how individual events or features,
such as shops, disease locations, or trees are arranged in space. Unlike
earlier labs that used fixed areas like counties, this method does not
rely on predefined boundaries. Instead, Point pattern analysis is
concerned with describing patterns of points over space and making
inference about the process that could have generated an observed
pattern. The techniques are widely used in fields like public health,
urban planning, and environmental science.</p>
<ul>
<li>This is a great overview, <a
href="https://r-spatial.org/book/11-PointPattern.html"
class="uri">https://r-spatial.org/book/11-PointPattern.html</a></li>
</ul>
<p><br><br></p>
<div id="report-style---important" class="section level3">
<h3>Report style - important!</h3>
<p>You will be graded on your report style. To get an A grade, submit a
clean, well-organized report. You should use headings and sub-headings,
keep code output tidy, make sure all units are included and write clear
explanations beneath each task.</p>
<p>Your report should make it easy for the reader to locate each answer
and understand how your results relate to real-world questions. Only
polished, professional submissions will receive 100%.</p>
<p><br><br></p>
</div>
<div id="the-spatstat-package" class="section level3">
<h3>The spatstat package</h3>
<p>In this lab you will begin working with the R package spatstat, which
is specifically designed for spatial point-pattern analysis. Although
its interface can feel somewhat old fashioned and it hates sf/terra, it
remains one of the most comprehensive environments for working with
spatial point processes. The package is supported by a large body of
documentation, including a dedicated textbook and an active set of
online resources. <br></p>
<p>You will learn how to prepare your data so that it can be used
effectively for spatial analyses by converting it into the appropriate
format used by spatstat. This initial exercise will give you a
conceptual foundation before we start manipulating data.</p>
<p><br><br></p>
</div>
<div id="tasks" class="section level3">
<h3>Tasks</h3>
<ol style="list-style-type: decimal">
<li>Explain the basics</li>
</ol>
<ul>
<li><p>Remembering to use headings/sub-headings so it’s easy for us to
find your answer, describe what point pattern is - and link to one
resource online that helps describe point pattern analysis other than
the spatstat and R-spatial books.</p></li>
<li><p>Visit the spatstat FAQ page at <a
href="https://spatstat.org/FAQ.html"
class="uri">https://spatstat.org/FAQ.html</a> and explore the
content.<br></p></li>
<li><p>Remembering to use headings and sub-headings, write (at minimum)
50 words describing what spatstat is and any features or aspects of the
package that seem especially useful or interesting.<br></p></li>
</ul>
<p><br><br></p>
</div>
</div>
<div id="b.-set-up-your-case-study." class="section level2">
<h2><strong>B. Set up your case study.</strong></h2>
<p>This lab focuses on understanding the spatial patterns of McDonald’s
restaurants and high schools across Upstate New York. First we need to
get the data<br></p>
<ol start="2" style="list-style-type: decimal">
<li>Loading the data</li>
</ol>
<ul>
<li><p>Download <code>Lab6_SpatialData_NY.RData</code> from canvavs and
put them into your Lab 7 folder.<br><br></p></li>
<li><p>A .RData file stores a collection of R objects so that you can
load several datasets at once. Add a new code chunk and use the load()
function to bring the data into your session.</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;Lab7_SpatialPoint_NY.RData&quot;</span>)</span></code></pre></div>
<ul>
<li><p>Run BOTH your library code chunk and this one, then click on your
environment tab, you should see that it has downloaded several datasets
about New York. <br><br></p></li>
<li><p>Look at the Environment tab and you’ll see several datasets have
appeared:</p>
<ul>
<li><p><code>median_income</code> and <code>pop_density</code> are
derived from census tract vector data from the American Community
Survey. Rather than our normal vector format, they are saved as
<em>raster images</em> (to make the point pattern code work).
<br></p></li>
<li><p><code>Schools</code> is a point dataset containing the location
of all the high-schools in Upstate New York State as of 2022-2023. I
obtained it from the New York State GIS portal<br></p></li>
<li><p><code>McDonalds</code> is a dataset containing the location of
all the McDonalds resturants in Upstate New York State. I obtained it
from kaggle and I don’t know the original source <br></p></li>
</ul></li>
</ul>
<p><strong>THIS WILL ONLY WORK IF YOU HAVE RUN THE LOAD LIBRARY CODE
CHUNK TO LOAD THE SPATSTAT PACKAGE. If you see a list of stuff and it
doesn’t make a map, install and load library(spatstat)</strong></p>
<p><br><br></p>
</div>
<div id="c.-data-exploration" class="section level2">
<h2><strong>C. Data Exploration</strong></h2>
<ol start="3" style="list-style-type: decimal">
<li>Mapping your data</li>
</ol>
<p>Before working with point-pattern tools, it is useful to take a first
look at how the Schools and McDonald’s locations are distributed across
New York. The example below creates an interactive map of the school
locations using tmap in view mode:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">tm_shape</span>(Schools) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">fill_alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="st">&quot;OpenStreetMap&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">&quot;High Schools in New York&quot;</span>)</span></code></pre></div>
<p><br></p>
<ul>
<li>Get this map working in your report, then create a similar map for
the McDonald’s dataset. You are encouraged to adjust the style:
experiment with point size, colour, basemaps, or additional layers such
as the New York State boundary (<code>stateborder.utm</code>). For
basemap ideas, see the preview gallery at <a
href="https://leaflet-extras.github.io/leaflet-providers/preview/"
class="uri">https://leaflet-extras.github.io/leaflet-providers/preview/</a>.</li>
</ul>
<p><br><br></p>
<ol start="4" style="list-style-type: decimal">
<li>Explain the patterns &amp; likely process causing them</li>
</ol>
<p>In your report, underneath the plots begin by briefly describing what
each dataset represents. Then compare the spatial distributions of
Schools and McDonald’s locations across New York State. Draw on the
examples from Lectures 7–8 and Homework 3 to structure your
interpretation.:<br></p>
<ul>
<li><p>Describe whether each dataset appears to show positive, zero, or
negative spatial autocorrelation. Comment on whether this conclusion
changes as you adjust the spatial domain/scale of observation (for
example, when zooming in to a city versus viewing the entire state).
<br></p></li>
<li><p>Explain the possible spatial processes that may be generating
these patterns. As a hint, if you were asked to predict where new
Schools or McDonald’s locations might appear in another state, what
variables or contextual information would you consider?:<br></p></li>
<li><p>Discuss whether each observed patterns seems driven by
first-order processes, second-order processes, or a combination of both
- and explain what you mean by these terms. Hint, see <a
href="https://mgimond.github.io/Spatial/chp11_0.html"
class="uri">https://mgimond.github.io/Spatial/chp11_0.html</a>:<br></p></li>
<li><p>Discuss whether the interpretation of either dataset may be
affected by each of these spatial issues, explaining your reasoning for
each.</p>
<ul>
<li><p>the locational fallacy:<br></p></li>
<li><p>non-uniformity of space:<br></p></li>
<li><p>the Modifiable Areal Unit Problem (MAUP)<br><br>:<br></p></li>
</ul></li>
</ul>
<p><br><br></p>
<ol start="5" style="list-style-type: decimal">
<li>Find the map projection</li>
</ol>
<p>If you type Schools into the console and press enter, you should see
in the summary that your data’s coordinates are not lat/long. It’s good
practice to know what map projection your data is in.</p>
<ul>
<li>To do this, you can use the <code>st_crs()</code> command, e.g.try
this</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">st_crs</span>(Schools)</span></code></pre></div>
<ul>
<li>At the top of the output you should see the EPSG code. <br><br></li>
<li>Google/chatgpt the code and in your report, explain what the map
projection is, why I chose it and what units it is in.</li>
</ul>
<p><br><br></p>
</div>
<div id="d.convert-the-data-into-spatstat-format"
class="section level2">
<h2><strong>D.Convert the data into ‘spatstat’ format</strong></h2>
<div id="converting-data-to-the-ppp-format" class="section level3">
<h3>Converting data to the ppp format</h3>
<p>All of the point pattern tools used in this section come from the
spatstat package. These commands work with points stored in ppp objects
rather than the sf objects you have used so far. Once we move into
spatstat, packages such as tmap will no longer work as expected.</p>
<p><br></p>
<ol start="6" style="list-style-type: decimal">
<li>Creating a window for the study area</li>
</ol>
<p>A key requirement of spatstat is that each point pattern must be
associated with a clearly defined spatial window to show the boundary of
the point data. <br><br></p>
<ul>
<li>We begin by converting the New York State boundary into an owin
object. This defines the spatial window for our analysis so that the
point pattern is evaluated within the state boundary rather than within
a simple rectangular extent. Run the code below in your own lab setup.
It creates the window object we will use throughout:<br></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>stateborder.owin <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(stateborder)</span></code></pre></div>
<p><br><br></p>
<ol start="7" style="list-style-type: decimal">
<li>Make your data a ppp (point pattern object)</li>
</ol>
<p>Now we need to convert our data into a ppp object.</p>
<ul>
<li>For this first step we will work with unmarked point data. For both
the Schools and McDonalds datasets, extract only the geometry (the X and
Y coordinates), convert each to a ppp object, and then assign the New
York window you created above. Here is the code for Schools. Get it
working in your report and also make one for McDonalds</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Just take XY locations</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>School.locs  <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(Schools)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># Convert to point pattern format</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>School.ppp  <span class="ot">&lt;-</span> <span class="fu">as.ppp</span>(School.locs)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># Set the domain to be NY State</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">Window</span>(School.ppp) <span class="ot">&lt;-</span> stateborder.owin</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>School.ppp</span></code></pre></div>
<pre><code>## Planar point pattern: 404 points
## window: polygonal boundary
## enclosing rectangle: [602098.7, 1133211.9] x [4645947, 5012753] units</code></pre>
<p><br><br></p>
<ol start="8" style="list-style-type: decimal">
<li>Make your data a ppp (point pattern object)</li>
</ol>
<ul>
<li>To make a good looking map in spatstat, we need to play with the
plot margins. You can see how I did that here for the schools data. Get
this working in your code and also make a map of the McDonalds
data.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Save current plot settings</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co"># Make temporary changes to make the margin smaller</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="at">mar =</span> <span class="fu">c</span>(.<span class="dv">5</span>,.<span class="dv">5</span>,<span class="dv">1</span>,.<span class="dv">5</span>),</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="at">cex.main =</span> .<span class="dv">9</span>)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co"># Produce your plot</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">plot</span>(School.ppp,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>     <span class="at">cols =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>     <span class="at">cex =</span> .<span class="dv">5</span>,</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Point pattern of NY schools data&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Restore previous plot settings</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code></pre></div>
<p><br><br></p>
<ol start="9" style="list-style-type: decimal">
<li>Convert units to kn.</li>
</ol>
<p>All of our objects are currently measured in metres. Because we are
working at the scale of an entire state, reporting results in metres is
unwieldy. We will therefore convert every dataset to kilometres.</p>
<ul>
<li>Run the code below in your report for schools. <strong>If you
encounter errors, tell Kiely or Dr G.</strong> If it really doesn’t
work, skip the conversion, re-run your code from the start, and continue
the lab using metres. <br></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># First reload the spatstat geom package.  You don&#39;t need to move it to the top as I want to force it to be the final package loaded</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">library</span>(spatstat.geom)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>School.ppp    <span class="ot">&lt;-</span> spatstat.geom<span class="sc">::</span><span class="fu">rescale</span>(School.ppp, <span class="dv">1000</span>, <span class="st">&quot;km&quot;</span>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>median_income <span class="ot">&lt;-</span> spatstat.geom<span class="sc">::</span><span class="fu">rescale</span>(median_income, <span class="dv">1000</span>, <span class="st">&quot;km&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>pop_density   <span class="ot">&lt;-</span> spatstat.geom<span class="sc">::</span><span class="fu">rescale</span>(pop_density, <span class="dv">1000</span>, <span class="st">&quot;km&quot;</span>)</span></code></pre></div>
<ul>
<li>If that worked, also convert the units of your McDonalds data to
km.</li>
</ul>
<p><br><br></p>
</div>
</div>
<div id="e-modelling-first-order-effects" class="section level2">
<h2><strong>E Modelling first order effects</strong></h2>
<p>In spatial point pattern analysis, first-order effects refer to
variations in the intensity of points across a study area due to
external factors. These effects describe how the likelihood of observing
a point changes from one location to another, independent of the
presence or absence of other points. For example, oak trees may be more
densely distributed in areas with favorable soil conditions, or retail
stores may cluster in regions with higher population density. In both
cases, the spatial variation is driven by underlying environmental or
socioeconomic covariates rather than interactions between the points
themselves.</p>
<p><strong>To explore first order effects, we look at the density of
points across our study area and see how that compares to point patterns
made by different processes.</strong></p>
<p><a
href="https://mgimond.github.io/Spatial/chp14_0.html#understanding-intensity-and-density-in-point-patterns"
class="uri">https://mgimond.github.io/Spatial/chp14_0.html#understanding-intensity-and-density-in-point-patterns</a></p>
<p><br><br></p>
<ol start="10" style="list-style-type: decimal">
<li>Explain the background</li>
</ol>
<ul>
<li><p>Make a new level one heading called First order effects.</p></li>
<li><p>One piece of jargon to understand is the difference between
intensity and density. In your report, using this tutorial, <a
href="https://mgimond.github.io/Spatial/chp14_0.html#understanding-intensity-and-density-in-point-patterns"
class="uri">https://mgimond.github.io/Spatial/chp14_0.html#understanding-intensity-and-density-in-point-patterns</a>
, explain the difference in your own words.</p></li>
</ul>
<p><br><br></p>
<div id="f.-global-density" class="section level3">
<h3><strong>F. Global Density</strong></h3>
<p>A simple summary of a point pattern’s intensity is its global
density: the number of points per unit area. For example, we might
report penguins per square mile or flowers per square foot. The formula
is simple: <em>global density = number of points / area of the study
region</em>.</p>
<p>But we are assuming that the pattern is homogeneous, e.g. you don’t
have clusters or hotspots of points that vary across your study domain.
Here is how to compute this quantity and write it up for the schools
dataset:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Number of points</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>num_points <span class="ot">&lt;-</span> <span class="fu">npoints</span>(School.ppp)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>num_points</span></code></pre></div>
<pre><code>## [1] 404</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Area of the study region</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>study_area <span class="ot">&lt;-</span> <span class="fu">area.owin</span>(<span class="fu">Window</span>(School.ppp))</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>study_area</span></code></pre></div>
<pre><code>## [1] 114728.4</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Global density</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>global_density <span class="ot">&lt;-</span> num_points <span class="sc">/</span> study_area</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>global_density</span></code></pre></div>
<pre><code>## [1] 0.00352136</code></pre>
<p>So this code suggests that in New York State, there are 0.0072
schools per square km. E.g. if the schools were evenly distributed in a
grid-like pattern, the average distance between schools would be around
12 kilometers in any direction.</p>
<p><strong>How did I get this?:</strong> 1/0.0072 ~ 139, this means if
schools were evenly distributed in a grid like pattern then there would
be roughly one school every 139 square kilometers. Taking the square
root of 139 gives about 11.79, so if the schools were evenly distributed
in a grid-like pattern, the average distance between schools would be
approximately 12 kilometers in each direction.</p>
<p><br><br></p>
<ol start="11" style="list-style-type: decimal">
<li>Repeat for McDonalds</li>
</ol>
<ul>
<li><p>Calculate and interpret the global density for the McDonalds
data. Is it greater or lesser than the schools intensity.</p></li>
<li><p>(A* bonus question): How does the non-uniformity of space impact
this result?</p></li>
</ul>
<p><br><br></p>
</div>
<div id="g-local-density-kernel-smoothing" class="section level3">
<h3><strong>G Local density: Kernel Smoothing</strong></h3>
<p>A second way to explore first-order properties is to examine how
density varies <strong>locally</strong> across the study area. One
common approach is <strong>kernel density estimation (KDE)</strong>,
which produces a continuous surface showing where points are more or
less concentrated.</p>
<p>The basic idea is straightforward: imagine sliding a circular window
across the map and counting how many points fall inside that window at
each location. The result is a smoothed surface, which we can use as our
best guess of the true underlying intensity.</p>
<p><img src="index_images/pg_Lab6_Kernelexplanation.png" /></p>
<p><br></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;index_images/pg_Lab6_KernelBandwidthEsri2.png&quot;</span>)</span></code></pre></div>
<p><br><br></p>
<ol start="12" style="list-style-type: decimal">
<li>Kernel density using the default bandwidth</li>
</ol>
<ul>
<li><p>Use the code below to calculate a kernel density surface for the
schools data using the default bandwidth. Once it works, copy and adapt
the code to create a second version for the McDonald’s dataset.
<br></p></li>
<li><p>Compare the Schools and McDonald’s maps in your own words. What
similarities and differences do you see? <br></p></li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>SchoolDensity1 <span class="ot">&lt;-</span> <span class="fu">density</span>(School.ppp)   <span class="co"># Default bandwidth</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">plot</span>(SchoolDensity1, <span class="at">main =</span> <span class="cn">NULL</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">contour</span>(SchoolDensity1, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><br><br></p>
<div id="kde-adjusting-the-bandwidth" class="section level4">
<h4>KDE adjusting the bandwidth</h4>
<p>Within KDE, you can decide how big you want your smoothing window to
be. The width of this window is controlled by the
<strong>bandwidth</strong>, which determines how coarse or fine the
surface will appear.</p>
<p><br></p>
<p><img src="index_images/pg_Lab6_KernelBandwidthEsri.png"
style="width:90.0%" /></p>
<p><br></p>
<p>Different bandwidths tell us different stories about the data. In the
example above, the large bandwidth on the left highlights the parts of
the city most prone to late-night road accidents but blurs local detail.
The small bandwidth on the right reveals specific streets but makes it
harder to see the overall pattern.</p>
<p><strong>There is no single “correct” bandwidth.</strong> Changing it
often reveals different aspects of the underlying process. So we mostly
use KDE for EXPLORATORY analysis.</p>
<p>Click here to read more and see some examples in R. <a
href="https://mgimond.github.io/Spatial/point-pattern-analysis-in-r.html#kernel-density-raster"
class="uri">https://mgimond.github.io/Spatial/point-pattern-analysis-in-r.html#kernel-density-raster</a></p>
<p><br><br></p>
<ol start="13" style="list-style-type: decimal">
<li>Assess how the bandwidth impacts your results.</li>
</ol>
<ul>
<li>Edit your existing KDE code to include the sigma option (as shown
below). For example, if your units are kilometres, sigma = 50 means you
are smoothing over a radius of about 50 km, while sigma = 5 focuses on
patterns at around 5 km. <br></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>SchoolDensity <span class="ot">&lt;-</span> <span class="fu">density</span>(School.ppp, <span class="at">sigma=</span><span class="dv">5</span>) </span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">plot</span>(SchoolDensity, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">contour</span>(SchoolDensity, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><br></p>
<ul>
<li><p>Run the same code several times for both the Schools and
McDonald’s data, varying sigma from a very small value (e.g. 1 km) to a
very large one (e.g. 1000 km). As you change sigma, think about the
real-world processes that might be driving the patterns you see.
<br><br></p></li>
<li><p>For your report, choose a final bandwidth for each dataset
(Schools and McDonald’s) that helps you say something interesting about
the pattern in relation to New York’s geography or environment. Include
the corresponding maps and briefly explain your reasoning below each
map. <br><br></p></li>
<li><p>A* bonus question: Explain how the bandwidth issue links with
MAUP’s scale effect.<br></p></li>
</ul>
<p><br><br></p>
</div>
<div id="week-1-complete" class="section level4">
<h4>WEEK 1 COMPLETE</h4>
<hr />
</div>
</div>
</div>
</div>
<div id="week-2" class="section level1">
<h1>WEEK 2</h1>
<div id="modelling-2nd-order-effects" class="section level2">
<h2>Modelling 2nd order effects</h2>
<div id="h.-nearest-neighbour-analysis" class="section level3">
<h3><strong>H. Nearest neighbour analysis</strong></h3>
<p>The nearest-neighbour distance measures, for each point in a pattern,
how far away its closest other point lies. It captures the local spacing
between points and is highly sensitive to whether the pattern is
clustered, random, or inhibited. When many points have very small
nearest-neighbour distances, this indicates clustering; when distances
are consistently large, the pattern shows regularity or repulsion. Under
complete spatial randomness (CSR), nearest-neighbour distances follow a
known theoretical distribution, so departures from it reveal
second-order effects—interactions between points that cannot be
explained by intensity alone. For this reason, summary functions based
on nearest-neighbour distances, such as the L-function, are widely used
to diagnose spatial interaction in point pattern analysis.</p>
<p>There is a NEW READING on the canvas lab page that will help as your
guide to this <a
href="https://psu.instructure.com/courses/2396422/assignments/17585717"
class="uri">https://psu.instructure.com/courses/2396422/assignments/17585717</a>
You want from the start to the end of section 14.1.</p>
<p><br><br></p>
<ol start="14" style="list-style-type: decimal">
<li>Calculate &amp; plot nearest neighbours</li>
</ol>
<ul>
<li>The <code>nndist</code> command calculates the distance between each
point and its nearest neighbour. Because it’s just calculating a list of
numbers, we can add it as a new column to our dataset and treat it like
any other column. Here I added it as a new column to both the ppp
version of schools and the original dataset.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># Use the nndist command, then save the result as a new column in the schools data</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>School.ppp<span class="sc">$</span>NearestNeighbourDist <span class="ot">&lt;-</span> <span class="fu">nndist</span>(School.ppp)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>Schools<span class="sc">$</span>NearestNeighbourDist    <span class="ot">&lt;-</span> <span class="fu">nndist</span>(School.ppp)</span></code></pre></div>
<p><br></p>
<ul>
<li><p>Use the code above to calculate the nearest neighbour distances
for the schools data. Once it works, copy and adapt the code to create a
second version for the McDonald’s dataset.<br><br></p></li>
<li><p>For each of your Schools and McDonalds datasets, take the mean of
your nearest neighbour column, then use the round command to round it to
two decimal places. <br><br></p></li>
<li><p>Plot a professional looking histogram of the nearest neighbour
column of the Schools data and of the McDonalds datasets.<br></p>
<ul>
<li>*By professional, I mean it’s something you would be happy showing
in a job interview (E.g. easy to interpret, correct units, labels
etc..). For code examples, see my STAT-462 tutorial and scroll down for
many different ideas you could tweak: <a
href="https://psu-spatial.github.io/Stat462-2024/T6_plots.html#histograms-1"
class="uri">https://psu-spatial.github.io/Stat462-2024/T6_plots.html#histograms-1</a>{.uri
_blank=““}*<br><br></li>
</ul></li>
<li><p>Under the histograms, the Schools and McDonald’s nearest
neighbour distributions in your own words.<br></p>
<ul>
<li><p>What similarities and differences do you see and how does this
link to the underlying processes ‘causing’ schools and
McDonalds?<br></p></li>
<li><p>As a hint, your write up should include the words <em>“Schools in
Upstate New York, are on average 8.79km apart.”</em> and similar for
your McDonalds data.</p></li>
</ul></li>
</ul>
<p><br><br></p>
<div id="r.ratio" class="section level4">
<h4><strong>R.Ratio</strong></h4>
<p>We can now calculate the R.Ratio and see if it is unusual compared to
a pattern caused by an IRP by using a Clarke Evans test. We will cover
this in class on Wednesday, but for now, refer to this reading on
Canvas: <a
href="https://psu.instructure.com/courses/2396422/assignments/17585717"
class="uri">https://psu.instructure.com/courses/2396422/assignments/17585717</a>
(YOU NEED SECTION 14.1.)</p>
<p><br><br></p>
<ol start="15" style="list-style-type: decimal">
<li>Explain the R.Ratio</li>
</ol>
<ul>
<li><p>In the text explain what the R Ratio is and what you would expect
for: <br></p>
<ul>
<li><p>A very clustered point pattern</p></li>
<li><p>Complete spatial randomness</p></li>
<li><p>A very uniform/gridded point pattern</p></li>
</ul></li>
</ul>
<p><br><br></p>
</div>
<div id="clarke-evans-hypothesis-test" class="section level4">
<h4><strong>Clarke Evans Hypothesis test</strong></h4>
<p>Here is the code for a Clarke Evans hypothesis test to check if our
observed schools point pattern is EITHER unusually clustered OR
unusually regular/gridded, compared to what we would expect if the
pattern was generated by an IRP.</p>
<p><br></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a> <span class="fu">clarkevans.test</span>(School.ppp, <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<p><br></p>
<p>It’s also possible to edit this code for a one sided test e.g.</p>
<ul>
<li><p>`H1: alternative=“clustered”`: Our observed pattern is unusually
clustered compared to a pattern generated by an IRP. <br></p></li>
<li><p>`H1: alternative=“regular”`: Our observed pattern is unusually
gridded/regular compared to a pattern generated by an IRP.</p></li>
</ul>
<p>A full explanation and write up of the test and its interpretation
can be found in the Canvas reading:<a
href="https://psu.instructure.com/courses/2396422/assignments/17585717"
class="uri">https://psu.instructure.com/courses/2396422/assignments/17585717</a>
(SECTION 14.1)</p>
<p><br><br></p>
<ol start="16" style="list-style-type: decimal">
<li>Run your own Clarke-Evans test</li>
</ol>
<ul>
<li><p>Run a Clarke-Evans test to answer this question: “<em>Are
<strong>schools</strong> more regularly spaced (more “gridded”) than we
would expect from an Independent Random Process?</em>” <br></p></li>
<li><p>You may choose your own p-value threshold, but you must justify
your choice.</p></li>
<li><p>I want to see your code and a write up. Your write up must
include:</p>
<ul>
<li><p>The null hypothesis (H0)</p></li>
<li><p>The alternative hypothesis (H1)</p></li>
<li><p>The observed test statistic</p></li>
<li><p>The test statistic you would expect if H0 were true</p></li>
<li><p>The p-value</p></li>
<li><p>A clearly stated conclusion</p></li>
</ul></li>
</ul>
<p><br><br></p>
</div>
</div>
<div id="i.-l-function" class="section level3">
<h3><strong>I. L-Function</strong></h3>
<p>TO COME (literally in 5 mins), REFRESH YOUR PAGE</p>
<p><br><br></p>
<hr />
</div>
</div>
</div>
<div id="submitting-your-lab" class="section level1">
<h1>Submitting your Lab</h1>
<p>Remember to save your work throughout and to spell check your writing
(next to the save button). Now, press the knit button again. If you have
not made any mistakes in the code then R should create a html file in
your lab3 folder, complete with a very recent time-stamp.</p>
<p><br><br></p>
<div id="if-you-are-on-posit-cloud" class="section level3">
<h3>If you are on posit cloud:</h3>
<p>You can download each of your .RmD and html files by:</p>
<ul>
<li><p>Clicking on the little box next to the Rmd in the Files tab, then
going to the little blue cogwheel (might need to make your Rstudio full
screen) and clicking export.<br></p></li>
<li><p>Repeat the process exactly for the html file underneath it (e,g,
just have the html clicked.)<br></p></li>
<li><p>Now go to Canvas and submit BOTH your html and your .Rmd file in
Lab 6.</p></li>
</ul>
<p><br></p>
</div>
<div id="posit-desktop" class="section level3">
<h3>Posit desktop</h3>
<ul>
<li><p>Go to your Lab 6 folder, In that folder, double click on the html
file. This will open it in your browser. CHECK THAT THIS IS WHAT YOU
WANT TO SUBMIT <br></p></li>
<li><p>Now go to Canvas and submit BOTH your html and your .Rmd file in
Lab 6.<br></p></li>
</ul>
<p><br><br></p>
<hr />
<p><br />
</p>
</div>
</div>
<div id="grading-rubric" class="section level1">
<h1>GRADING RUBRIC</h1>
<p>To come</p>
<p><br><br></p>
<div id="overall" class="section level2">
<h2>Overall</h2>
<p>Overall, here is what your lab should correspond to:</p>
<table class=" lightable-classic-2 table table-striped table-hover table-responsive" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto; color: black; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Grade
</th>
<th style="text-align:left;">
% Mark
</th>
<th style="text-align:left;">
Rubric
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A*
</td>
<td style="text-align:left;">
98-100
</td>
<td style="text-align:left;">
Exceptional.  Not only was it near perfect, but the graders learned
something.  THIS IS HARD TO GET.
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
96+
</td>
<td style="text-align:left;">
You went above and beyond
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
93+:
</td>
<td style="text-align:left;">
Everything asked for with high quality.   Class example
</td>
</tr>
<tr>
<td style="text-align:left;">
A-
</td>
<td style="text-align:left;">
90+
</td>
<td style="text-align:left;">
The odd minor mistake, All code done but not written up in full
sentences etc. A little less care
</td>
</tr>
<tr>
<td style="text-align:left;">
B+
</td>
<td style="text-align:left;">
87+
</td>
<td style="text-align:left;">
More minor mistakes.  Things like missing units, getting the odd
question wrong, no workings shown
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
83+
</td>
<td style="text-align:left;">
Solid work but the odd larger mistake or missing answer.  Completely
misinterpreted something, that type of thing
</td>
</tr>
<tr>
<td style="text-align:left;">
B-
</td>
<td style="text-align:left;">
80+
</td>
<td style="text-align:left;">
Starting to miss entire/questions sections, or multiple larger mistakes.
Still a solid attempt. 
</td>
</tr>
<tr>
<td style="text-align:left;">
C+
</td>
<td style="text-align:left;">
77+
</td>
<td style="text-align:left;">
You made a good effort and did some things well, but there were a lot of
problems. (e.g. you wrote up the text well, but messed up the code)
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
70+
</td>
<td style="text-align:left;">
It’s clear you tried and learned something.  Just attending labs will
get you this much as we can help you get to this stage
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
60+
</td>
<td style="text-align:left;">
You attempt the lab and submit something. Not clear you put in much
effort or you had real issues
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
0+
</td>
<td style="text-align:left;">
Didn’t submit, or incredibly limited attempt. 
</td>
</tr>
</tbody>
</table>
<p>And.. finished!</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
