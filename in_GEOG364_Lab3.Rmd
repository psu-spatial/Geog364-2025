---
title: "Lab 3:"
output:
  html_document:
    css: projectlab.css
    highlight: pygments
    theme: flatly
    toc: true
    toc_float: true
    toc_depth: 4
editor_options: 
  markdown: 
    wrap: sentence
---


```{r, include=FALSE,echo=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(eval = TRUE, 
                      fig.show = "hide", 
                      message = FALSE, 
                      warning = FALSE)

# Libraries
library(tidyverse)
library(AER)
library(broom)
library(ggplot2)
library(kableExtra)
library(openintro)
library(readxl)
library(skimr)
library(sp)
library(sf)
library(plotly)
library(tmap)
library(viridis)

# Data
house  <- read_excel("./index_data/Lab03_house.xlsx")
rubric <- read_excel("./index_data/Table_LabRubric.xlsx")
```



------------------------------------------------------------------------

\

# Welcome to Lab 3!

**Aim of the lab**

### THIS LAB IS UNDER CONSTRUCTION. DO NOT ATTEMPT YET!

\

::: {#boxedtext}
\
**Getting help** 
\
 - Kiely (and often Dr G) will be present during your lab sessions. This is the easiest way to get help. \
 - There is a Piazza discussion board. Kiely will explain more in this week‚Äôs lab and will check it at least once a day. \
 - Dr G has weekly office hours and genuinely enjoys helping with R, even if you feel stuck or overwhelmed. \
 - If you have posted on Piazza and received no response after 24 hours, you may send a Canvas message to Kiely or Dr G (or if you are completely lost).\
 \
:::

\

------------------------------------------------------------------------

\

# Set-up. DON'T SKIP!

\

### Create a project & get the data

There are two options here depending on whether you are using R-studio on the website (posit cloud) or your own computer (R-Desktop). If you are using a lab computerm choose the R-Desktop route.

#### Option 1. Posit Cloud Website Users

<details>

<summary>Task 1. Get the data from Canvas</summary>

<br>

Go to the Lab 3 Canvas page and download the dataset `Lab03_house.xlsx` <br>

</details>

::: small-gap
:::

<details>

<summary>Task 2. Create a project for Lab 3 (expand for instructions)</summary>

::: collapsible-content
<iframe src="https://psu-spatial.github.io/Stat462-2025/T5_ProjectsPositCloud.html" style="width: 100%; height: 700px; border: none;">
</iframe>
:::

<br>

</details>

::: small-gap
:::

<details>

<summary>Task 3. Upload your dataset to the website. (expand for reminder)</summary>

![](index_images/im_T2_Upload.png)


</details>

::: small-gap
:::

<details>

<summary>Task 4. Install more packages (expand for instructions)</summary>

<br>

Unfortunately on the website you need to install your packages each time.<br>Go to to the packages tab, click install to get to the app-store and download/install these packages:

-   `readxl`
-   `viridis`
-   `ggstatsplot`
-   `terra`
-   `tigris`
-   `tidyverse`
-   `dplyr`
-   `tmap`
-   `elevatr`
-   `osmdata`


We will also need a package called sf, which runs a lot of the spatial commands in R. Unfortunately, posit cloud sometimes has a few technical issues with sf, so you will need to run a special command.

IN THE CONSOLE, run these two commands.

```{r,eval=FALSE}
install.packages("remotes")
remotes::install_github(repo = "r-spatial/sf", ref = "93a25fd8e2f5c6af7c080f92141cb2b765a04a84")
```



T6_Packages.html
<br>*Reminder: [Tutorial: Packages
cheatsheet](https://psu-spatial.github.io/Stat462-2025/T6_Packages.html)*.

</details>

#### Option 2. R-Desktop Users

<details>

<summary>Task 1. Create a project for Lab 3</summary>

<br>

::: collapsible-content
<iframe src="https://psu-spatial.github.io/Stat462-2025/T5_ProjectsRDesktop.html" style="width: 100%; height: 700px; border: none;">
</iframe>
:::

</details>

::: small-gap
:::

<details>

<summary>Task 2. Get the data & **put in your Lab 3 folder**</summary>

<br>

Go to the Lab 3 Canvas page and download the dataset `Lab03_house.xlsx`. **Put it in your lab 3 folder.**

</details>

::: small-gap
:::

<details>

<summary>Task 3. Install some packages</summary>

<br>

We need to install some more packages.<br>Go to to the packages tab, click install to get to the app-store and download/install these packages. If your computer says its missing a package later on, install anything it suggests.

-   `elevatr`
-   `osmdata`

Remember DO NOT put `install.packages()` into your lab-script - copy and paste it into thee console.

<br>*Reminder: [Tutorial: Packages
cheatsheet](https://hgreatrex.github.io/Geog364_2024/pg_Tut3_basics.html#Tutorial_3G:_Packages)*.

</details>

<br>

### Set-up your Lab 3 report

You are welcome to use/edit the template you made in lab 2. If you are unsure what I mean by that, follow these instructions.

<details>

<summary>Task. Create your RMarkdown file - expand & look at Tutorial 4B and 4C</summary>

<br>

::: collapsible-content
<iframe src="https://hgreatrex.github.io/Geog364_2024/pg_Tut4_markdown.html#Tutorial_4B:_Creating_a_markdown_document" style="width: 100%; height: 700px; border: none;">
</iframe>
:::


</details>

::: small-gap
:::



<details>

<summary>Task. Edit your YAML code</summary>

<br>

Lets use similar options to Lab 2, although you could try a different theme.  Remember YAML code is annoying to edit, because here, *spaces really do matter*. Everything has to be perfect or it won't knit.

**Select everything in my code chunk here and replace your YAML with this (remember the --- on line 1 and at the end).**

Now edit the author name to your own.  If you wonder what Sys.Date() is, don't touch it - it automatically gives you the current date.

```{r,eval=FALSE}

---
title: "GEOG-364 - Lab 3"
author: "hlg5155"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: yes
    number_sections: yes
    theme: lumen
    df_print: paged
---
  
  
```





</details>

::: small-gap
:::

<details>

<summary>Task. Change the theme and knit</summary>

<br>

In the YAML code, change the theme to any one of your choice that isn't not lumen (see here to view available themes -
<https://bootswatch.com/>.). <br>

Some might not work, but these are likely to: ‚Äúdefault‚Äù, ‚Äúbootstrap‚Äù, ‚Äúcerulean‚Äù, ‚Äúcosmo‚Äù, ‚Äúdarkly‚Äù, ‚Äúflatly‚Äù, ‚Äújournal‚Äù, ‚Äúlumen‚Äù, ‚Äúpaper‚Äù, ‚Äúreadable‚Äù, ‚Äúsandstone‚Äù, ‚Äúsimplex‚Äù, ‚Äúspacelab‚Äù, ‚Äúunited‚Äù, ‚Äúyeti‚Äù.

</details>

::: small-gap
:::

<details>

<summary>Task. Clean the file and create/run your library code chunk</summary>

<br>

 - Click on your lab script (the Rmd file) and delete all the 'welcome text' after line 11.<br>Press enter a few times and make a new level-1 heading called `Set Up`.<br>

 - We should have all the packages we need installed, but we need to open them. Make a new code chunk containing this code.<br>

```{r,message=FALSE,warning=FALSE, eval=FALSE}
library(readxl)
library(tidyverse)
library(dplyr)
library(terra)
library(sf)
library(tmap)
library(elevatr)
library(osmdata)
library(ggstatsplot)
library(ggplot2)
library(hrbrthemes)
library(ggthemes)
library(viridis)
library(RColorBrewer)
library(plotly)
```

<br>

 - Press the green arrow on the right of the code chunk to run the code inside it. You will see a load of "loading text" telling your details about the packages you just loaded.<br><br> Press the green arrow AGAIN. The text should disappear unless there is an error.<br>

-   Note, remember to run this code chunk EVERY TIME your start R-Studio (in the same way you need to click on an app on your phone before you can use it). <br>

<br>

</details>

::: small-gap
:::

<details>

<summary>Task. Add warning=FALSE and message=FALSE to your library code chunk.
</summary>


<br>

 - Expand here for a tutorial.

::: collapsible-content
<iframe src="https://psu-spatial.github.io/Stat462-2025/T7_Markdown_4bCodeChunkOptions.html" style="width: 100%; height: 700px; border: none;">

</iframe>
:::

</details>

::: small-gap
:::

### Check your progress

Your lab script should now look similar this, but with your theme and YAML options of choice (you might have a few different libraries than in my screenshot). You should also be able to knit it successfully. If not, go back and do the previous sections!

<br>

![](index_images/pg_364Lab2_Summary_2021_fig2.png)

<br>



\

------------------------------------------------------------------------

\

# Moving to Taiwan

The aim of EVERY LAB is to get comfortable writing up analyses of a complex dataset for a specific person or user.  The modelling might be the same and we follow the same steps, but the context and topic will mean you will need to think hard about what is important in each case.

\

## Your Challenge

Your friend is about to move to Sindian District in New Taipei City, Taiwan. They‚Äôre thinking about buying a house‚Äîand they‚Äôve asked for your help figuring out what affects house prices in the area. This matters a lot because housing costs have soared in recent years ([Who can afford to live in Taipei?](https://english.cw.com.tw/article/article.action?id=3416)).

Luckily, you‚Äôve found a dataset, `Lab03_house.xlsx`, to help:  This is real-life data, which is described in detail here https://archive.ics.uci.edu/dataset/477/real+estate+valuation+data+set  
 
\

## *Your Goal* 
 
**You are writing the rest of this report for your friend!** 

You‚Äôre going to use the rest of this report to help your friend understand what influences house prices in New Taipei. Make sure to explain your findings clearly. Your friend doesn't study data science or geography, so make sure to use language your friend can understand.


\

1. In your report, create a new Level 1 heading called `House Prices`. 

Remember that you can click Visual mode and use the menu to do this, or put a single # at the front.

\

2. Check you are running your project

Before doing anything else, make sure:

 - You are running this lab inside your Lab 3 RStudio project
 - `Lab03_house.xlsx` is saved/uploaded in your *Lab 3 project folder* next to your lab report.

If not, go back to the **setup section** of this lab before continuing. The code below will not work until your project and files are properly set up. Also remmeber that you need to open your lab 3 project every time you reopen R-studio. 


\

2. Read in the data using read_excel() 

Once you‚Äôre ready, make a code chunk and write a line of code that uses `read_excel(FILENAME)` to read the Excel file into R, and **assign/save it a variable called house**.

<details>

<summary>Expand here for a tutorial on how to do this</summary>

::: collapsible-content
<iframe src="https://psu-spatial.github.io/Stat462-2025/in_T07_ReadingInData.html#14_Reading_in_excel_files" style="width: 95%; height: 600px; border: none;">

</iframe>
:::

</details>

::: small-gap
:::

::: {#boxgreen}
**üîç Reminder**
This command will only work if you have already run the library code chunk that loads the readxl package - and you need to re-run the library code chunk every time you open R.
:::

\


4. Summarise the data for your friend

Your goal here is to use R summary commands and plots, along with the background reading, to **explore and describe your dataset for your friend**. The goal is to help them understand what this data does (and doesn't) include, and to explain what it can tell them about house prices in New Taipei City.

 - If you haven't already, start by reading the dataset description here:
[Real estate valuation data set ‚Äì UCI](https://archive.ics.uci.edu/ml/datasets/Real+estate+valuation+data+set)

 - In your report, use command like `summary()` OR `skim()` (or others!) to explore the house data. See the tutorials below.

 - Then, in your report, **write a short section that describes the dataset in clear language for your friend**. This should must include: <br>
  + **The object of analysis**:  What does each row in the dataset represent? <br>
  + **A list of the variables AND THEIR UNITS**: Briefly describe each column in the data, including what it measures and the unit (e.g., meters, square meters, years). Remember the dataset description.. <br>
  + **The 'strict population' (sampling frame)**: <br>
  + **A reasonable, justifiable target population**: Based on this sample, what group do you think the data can reasonably be used to represent? <br>
  + **A clear, professional-looking histogram of house prices in a new code chunk**: See the tutorials below <br>
  + **Summary statistics of the variables, explained in context**: Then choose a few key variables and explain what the numbers mean for your friend. For example, can they walk to the station from most places?  Are most of the homes near shops? <br>
  + **Note any limitations from this data**:  E.g. are there any aspects of the data that arent going to help your friend (hint, think about the units of price..) <br>


<details>

<summary>Expand here for a tutorial on how to summarise data</summary>

::: collapsible-content
<iframe src="https://psu-spatial.github.io/Stat462-2025/CH3_EDA.html#23_Summary_Statistics" style="width: 95%; height: 600px; border: none;">
</iframe>
:::

</details>

::: small-gap
:::


<details>

<summary>Expand here for a tutorial on how to make histograms</summary>

::: collapsible-content
<iframe src="https://psu-spatial.github.io/Stat462-2025/in_T11_Plots.html#21_Set-up" style="width: 95%; height: 600px; border: none;">

</iframe>
:::

</details>

::: small-gap
:::



2. Read into R (read_excel) and check structure

3. Clean and rename columns if needed

4. Convert to spatial object (st_as_sf, crs = 4326)

## Define the study and data context

5. State the decision problem (friend/boss house-buying question)

6. Define the population of interest and discuss representativeness

7. Describe key variables and their units (response = House.Price). Inc Summary statistics and distribution of House.Price (mean, median, range, IQR ‚Äì and histogram)

8. Note any data limitations (temporal coverage, sample bias, missing variables)

9. Discuss spatial fallacies/properties e.g. locational fallacy? (nope) etc etc


## Add more data

### Elevation raster (get_elev_raster)

10. Get elevation

### OpenStreetMap

11. OpenStreetMap features: railway lines, stations, parks, roads

## Spatial analysis and mapping

12. Quick interactive map of points coloured by price (tmap, qtm)

13. Main map from my example

14. Describe spatial patterns

15. Simple linear regression (price ~ latitude)  
Use maps to explain the scatterplots e.g. should I just walk north

## Conclusions

16. What processes are happening? Summarise main drivers of price from combined evidence
Discuss practical implications for a house-buyer


------------------------------------------------------------------------

\

# Show me something new!

adasdsad


\

------------------------------------------------------------------------

\

# What to submit?

asdjnasda

<br>


\

------------------------------------------------------------------------

\

# Grading rubric

## Overall

Overall, here is what your lab should correspond to:

```{r, echo=FALSE}
knitr::kable(rubric) %>%   
  kable_classic_2() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive"))

```

And..
finished!
